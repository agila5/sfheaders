---
output: github_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

library(sfheaders)
```

[![Travis build status](https://travis-ci.com/dcooley/sfheaders.svg?branch=master)](https://travis-ci.com/dcooley/sfheaders)
[![Coverage status](https://codecov.io/gh/dcooley/sfheaders/branch/master/graph/badge.svg)](https://codecov.io/github/dcooley/sfheaders?branch=master)

# sfheaders


## Another spatial library?

Yep. In a few of my other libraries I've made use of `sf` objects, but without importing the `sf` library itself. This is by design because `sf` is quite a 'heavy' library. 

Therefore I've written / copied these methods for constructing the `sf` objects across a few different libraries. 

So I thought it would be useful to have these in one place. And here they are (or will be, when it's finished).



## Can I use these methods too?

Yep


### sfg

#### from R

```{r}

df <- data.frame(
  x = 1:5
  , y = 5:1
)

sfg_polygon( df )
```

#### from C++

there are various overloaded functions for each `sfg` and `sfc` type

- `sfheaders::sfg::sfg_point()`
- `sfheaders::sfg::sfg_multipoint()`
- `sfheaders::sfg::sfg_linestring()`
- `sfheaders::sfg::sfg_multilinestring()`
- `sfheaders::sfg::sfg_polygon()`
- `sfheaders::sfg::sfg_multipolygon()`

- `sfheaders::sfc::sfc_point()`
- `sfheaders::sfc::sfc_multipoint()`
- `sfheaders::sfc::sfc_linestring()`
- `sfheaders::sfc::sfc_multilinestring()`
- `sfheaders::sfc::sfc_polygon()`
- `sfheaders::sfc::sfc_multipolygon()`

```{r}
library(Rcpp)
library(sfheaders)

cppFunction(
  includes = '
    #include "sfheaders/sfg/sfg.hpp"
  ',
  code = '
    SEXP a_polygon( Rcpp::DataFrame df ) {
      return sfheaders::sfg::sfg_polygon( df );
    }
  ',
  depends = "sfheaders"
)

a_polygon( df )
```

```{r}
cppFunction(
  includes = '
    #include "sfheaders/sfg/sfg.hpp"
  ',
  code = '
    SEXP a_polygon( Rcpp::DataFrame df, Rcpp::StringVector geometry_columns ) {
      return sfheaders::sfg::sfg_polygon( df, geometry_columns );
    }
  ',
  depends = "sfheaders"
)

a_polygon( df, c("x","y") )

a_polygon( df, c("y", "x") )

```

```{r}
cppFunction(
  includes = '
    #include "sfheaders/sfg/sfg.hpp"
  ',
  code = '
    SEXP a_polygon( SEXP x, SEXP geometry_columns ) {
      return sfheaders::sfg::sfg_polygon( x, geometry_columns );
    }
  ',
  depends = "sfheaders"
)

a_polygon( df, c("x","y") )

a_polygon( df, c("y", "x") )

```


```{r}

cppFunction(
  includes = '
    #include "sfheaders/sfg/sfg.hpp"
  ',
  code = '
    SEXP a_polygon( SEXP df, std::string geom_type ) {
      return sfheaders::sfg::to_sfg( df, geom_type );
    }
  ',
  depends = "sfheaders"
)

a_polygon( df, "POLYGON" )

```


### sfc

```{r}
sfc_point( df )

sfc_multipoint( df )

sfc_polygon( df )
```


```{r}

cppFunction(
  includes = '
    #include "sfheaders/sfc/sfc.hpp"
  ',
  code = '
    SEXP a_polygon( SEXP df ) {
      return sfheaders::sfc::sfc_polygon( df );
    }
  ',
  depends = "sfheaders",
  plugins = "cpp11"
)

a_polygon( df )
```

```{r}

cppFunction(
  includes = '
    #include "sfheaders/sfc/sfc.hpp"
  ',
  code = '
    SEXP a_polygon( SEXP df, SEXP geometry_columns ) {
      return sfheaders::sfc::sfc_polygon( df, geometry_columns );
    }
  ',
  depends = "sfheaders",
  plugins = "cpp11"
)

a_polygon( df, c("x","y") )
```


```{r}

df <- data.frame(
  id = c( rep(1, 5), rep(2, 5) )
  , x = 1:10
  , y = 1:10
)

cppFunction(
  includes = '
    #include "sfheaders/sfc/sfc.hpp"
  ',
  code = '
    SEXP a_polygon( SEXP df, SEXP geometry_columns ) {
      return sfheaders::sfc::sfc_polygon( df, geometry_columns );
    }
  ',
  depends = "sfheaders",
  plugins = "cpp11"
)

a_polygon( df, c("x","y") )
```



```{r}

cppFunction(
  includes = '
    #include "sfheaders/sfc/sfc.hpp"
  ',
  code = '
    SEXP a_polygon( SEXP df, SEXP geometry_columns, SEXP polygon_id, SEXP linestring_id ) {
      return sfheaders::sfc::sfc_polygon( df, geometry_columns, polygon_id, linestring_id );
    }
  ',
  depends = "sfheaders",
  plugins = "cpp11"
)

a_polygon( df, c("x","y"), "id", NULL )
```

```{r}
# n <- 1e7
# df <- data.frame(
#   id = rep(1:(n / 2), each = 2),
#   x = rnorm( n ),
#   y = rnorm( n ),
#   z = rnorm( n )
# )
# 
# system.time({
#   res <- sfc_linestring( df, linestring_id = "id" )
# })
# 
# res
# 
# 
# 
# sfc_multipoint( df )
# sfc_multipoint( df, x = "x", y = "y", multipoint_id = "id" )


```
